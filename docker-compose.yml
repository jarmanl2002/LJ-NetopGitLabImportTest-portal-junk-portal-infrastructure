#rabbitmq container
messagebus:
  image: git.netop.com:4545/portal/portal-docker-images:dev-rabbitmq
  hostname: netop-rabbitmq
  volumes:
    - ./tools/rabbitmq.sh:/entrypoint/entrypoint.sh
  ports:
    - 5671:5671
    - 5672:5672
    - 25672:25672
    - 4369:4369
  entrypoint: bash -c "sh /entrypoint/entrypoint.sh"
#mysql container
database:
  image: git.netop.com:4545/portal/portal-docker-images:dev-mysql
  hostname: netop-mysql
  ports:
    - 3306:3306
  environment:
   - MYSQL_ROOT_PASSWORD=dev
#redis container
cache:
  image: git.netop.com:4545/portal/portal-docker-images:dev-redis
  hostname: netop-cache
  ports:
    - 6379:6379
#nginx continaer - serving the frontend apps
nas-local.netop.com:
  image: git.netop.com:4545/portal/portal-docker-images:dev-nginx
  hostname: "nas-local.netop.com"
  entrypoint: bash -c "sh /entrypoint/entrypoint.sh"
  volumes:
    - ./image-sources/nginx/nginx.conf:/etc/nginx/nginx.conf
    - ./workspace/portal-frontend/public/dist:/usr/share/nginx/html/portal
    - ./workspace/nas-frontend/public/dist:/usr/share/nginx/html/nas
    - ./workspace/weblogs:/var/log/nginx/netop
    - ./tools/nginx.sh:/entrypoint/entrypoint.sh
  ports:
    - 80:80
    - 443:443
#permissions worker container
netop-permissions:
  image: git.netop.com:4545/portal/portal-docker-images:dev-portal-services
  hostname: netop-permissions
  links:
    - messagebus
    - cache
  ports:
    - 3003:3003
  volumes:
    - ./workspace/permissions/project:/netop-worker/files
    - ./workspace/permissions/config:/netop-worker/config
    - ./workspace/permissions/logs:/netop-worker/logs
    - ./tools/wait-for-it-master:/tools
    - ./tools/permissions.sh:/entrypoint/entrypoint.sh
  entrypoint: bash -c "sh /entrypoint/entrypoint.sh"
#nas worker  container
netop-nas:
  image: git.netop.com:4545/portal/portal-docker-images:dev-portal-services
  hostname: netop-nas
  links:
    - netop-permissions
    - messagebus
    - cache
    - database
  ports:
    - 8084:8084
  volumes:
    - ./workspace/nas/project:/netop-worker/files
    - ./workspace/nas/config:/netop-worker/config
    - ./workspace/nas/logs:/netop-worker/logs
    - ./tools/wait-for-it-master:/tools
    - ./tools/nas.sh:/entrypoint/entrypoint.sh
  entrypoint: bash -c "sh /entrypoint/entrypoint.sh"
#portal worker container
netop-portal:
  image: git.netop.com:4545/portal/portal-docker-images:dev-portal-services
  hostname: netop-portal
  links:
    - nas-local.netop.com
    - database
    - cache
    - messagebus
    - netop-nas
  ports:
    - 8083:8083
  volumes:
    - ./workspace/portal/project:/netop-worker/files
    - ./workspace/portal/config:/netop-worker/config
    - ./workspace/portal/logs:/netop-worker/logs
    - ./tools/wait-for-it-master:/tools
    - ./tools/portal.sh:/entrypoint/entrypoint.sh
  entrypoint: bash -c "sh /entrypoint/entrypoint.sh"
